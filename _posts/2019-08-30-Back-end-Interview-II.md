---
layout: post
title: 'Java后端面试整理（二）'
author: Marty Pang
categories: 
  - Interview
tags: 
  - Java
  - Back-End
last_modified_at: 2019-08-30T12:52:09-05:00
---

网络跟操作系统的问题也问到不少，在此也做一个总结。

* 目录
{:toc}


# 网络

1. tcp与udp区别
  udp面向无连接，没有拥塞控制，面向报文，应用层传下来的数据不拆分也不合并，添加UDP头部；tcp面向连接，流量控制与拥塞控制，面向字节流，字节流组织成大小不等的块。

2. tcp三次握手四次挥手
  （确认号为收到的序列号+1，建立连接后，ACK一直为1）
客户端A发送连接请求报文（SYN=1，ACK=0，seq=x）到服务端B，
B收到请求后，发送确认连接报文（SYN=1，ACK=1，seq=y，ack=x+1），
A再次向B发送确认报文，确认号ack为y+1，seq为x+1，
B收到A的消息后，连接建立；
![](/images/handshake.png)
客户端A发送连接释放报文，FIN设置为1，seq为x，进入FIN_WAIT1状态，
服务端回复确认消息，确认号为x+1。序列号为y，此时A进入FIN_WAIT2状态，无法发送消息，只能接收，
服务端发送未发完的数据，B不需要连接之后，发送连接释放报文给A，确认号为x+1，序列号为z，A收到后发出确认，进入TIME_WAIT状态，等待一段时间（2倍最大报文存活时间）后释放连接；
![](/images/wavehand.jpg)

3. 为什么需要三次握手？
  防止打开失效连接，如果客户端的一个连接请求超时了，客户端再发一个，最终两个请求都到达服务端，服务端会开两个连接。如果有第三次握手，A会忽略B对滞留连接请求的确认消息，B收不到A的第三次握手，故不会建立第二个连接。

4. 为什么要四次挥手？
  服务端进入CLOSE_WAIT状态，可以发送未传送完毕的数据，发送完之后再发送连接释放报文。多了一次挥手。

5. 为什么不直接进入closed状态，而是time wait？
  确保最后一个确认报文能到达B

6. tcp流量控制
  通过滑动窗口大小控制发送发的发送速率。

7. tcp拥塞控制
- 慢开始 拥塞窗口状态变量初始设置为1，每收到一个确认，翻倍；
- 拥塞避免 状态变量达到一个阈值之后，每收到一个确认+1，当出现超时，设置阈值为超时是状态变量的一半，重新慢开始；
- 快重传 接收方每次收到报文，对最后一个收到的有序报文进行确认，如果发送发连续收到三次某一个报文的确认，说明下一个报文丢失了，发送发执行快重传
- 快恢复 在这种丢失个别报文的情况下，执行快恢复，即设置阈值为当前状态变量的一半，设置当前状态变量为阈值，直接进入拥塞避免；

8. 输入url到浏览器加载的过程
- 浏览器（应用层）DNS解析：浏览器缓存，本地host，运行商DNS缓存，根域名DNS服务器，顶级域名DNS服务器，逐步读取缓存直到获取IP；
- 浏览器针对目标服务器生成HTTP请求报文，包括起始行，header和body。header包括域名，user-agent和cookie信息等；
- 传输层建立TCP连接，HTTP使用TCP来传输数据，使用本地大于1024的一个随机端口与服务器80端口建立连接，发送http请求；
- 服务端发送http响应；
- 浏览器渲染；
- 四次挥手关闭连接；

9. HTTP与HTTPS协议
HTTP/1.1开始默认是长连接，引入cookie保存状态信息。HTTP明文通信，不互相验证身份，无法证明报文的完整性，故引入HTTPS。HTTPS使用混合加密机制，非对称加密用来传输对称密钥，之后的通信过程采用对称加密保证安全。TLS握手协议建立在TCP三次握手之上，用于客户端与服务端协商加密算法与密钥，ClientHello，ServerHello与ClientKeyExchange。HMAC保证数据完整性。
  HTTP请求包括请求行，请求头部与主体，响应包括状态行，响应头与响应主体。
  ![](/images/httprequest.png){:.align-center}
  请求行格式[方法，URI，协议/版本号]，方法包括GET，POST，PUT，DELETE等。GET与POST都能传送额外的参数，不同的是GET的参数写在请求行的URI里，POST的参数写在body里。
  ![](/images/httpresponse.png){:	.align-center}
  响应消息的状态码包括五类：
  - 1xx 接收的请求正在处理；
  - 2xx请求成功处理完毕；
  - 3xx重定向，需进行额外操作完成请求；
  - 4xx客户端错误，服务端无法解析请求；
  - 5xx服务端错误

10. nat是什么？属于哪一层？

  网络地址转换，网络层

11. 介绍一下网络分层的模型

    OSI七层网络架构：应用层，表示层，会话层，传输层，网络层，数据链路层，物理层

    五层模型：应用层，传输层，网络层，数据链路层，物理层

12. 链路层有什么协议？
